<div class="converter-container">
  <div class="header-section">
    <h1>JWT Decoder</h1>
    <div class="animated-icon">üîì</div>
  </div>

  <div class="card">
    <div class="input-section">
      <label for="jwt-input" class="label">Enter JWT Token:</label>
      <textarea
        id="jwt-input"
        [(ngModel)]="jwtInput"
        (input)="decodeJWT()"
        placeholder="Paste your JWT token here (eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...)"
        class="input-textarea"
        rows="6"
      ></textarea>

      @if (jwtInput()) {
        <div class="button-group">
          <button (click)="copyToken()" class="btn btn-secondary btn-small">üìã Copy Token</button>
          <button (click)="reset()" class="btn btn-secondary btn-small">üîÑ Clear</button>
        </div>
      }
    </div>

    @if (error()) {
      <div class="error-box"><strong>‚ö†Ô∏è Error:</strong> {{ error() }}</div>
    }

    @if (isValid()) {
      <div class="decoded-sections">
        <!-- Header Section -->
        <div class="decoded-section header-section-box">
          <div class="section-header">
            <h3>üìã Header</h3>
            <button (click)="copyHeader()" class="btn btn-primary btn-small">Copy</button>
          </div>
          <pre><code>{{ formatJSON(decodedJWT()!.header) }}</code></pre>
          <div class="raw-value"><strong>Raw:</strong> {{ decodedJWT()!.raw.header }}</div>
        </div>

        <!-- Payload Section -->
        <div class="decoded-section payload-section-box">
          <div class="section-header">
            <h3>üì¶ Payload</h3>
            <button (click)="copyPayload()" class="btn btn-primary btn-small">Copy</button>
          </div>
          <pre><code>{{ formatJSON(decodedJWT()!.payload) }}</code></pre>

          @if (
            decodedJWT()!.payload['exp'] ||
            decodedJWT()!.payload['iat'] ||
            decodedJWT()!.payload['nbf']
          ) {
            <div class="claims-info">
              <h4>‚è∞ Time Claims:</h4>
              @if (decodedJWT()!.payload['iat']) {
                <div class="claim-row">
                  <span class="claim-label">Issued At (iat):</span>
                  <span class="claim-value">{{
                    formatTimestamp(decodedJWT()!.payload['iat'])
                  }}</span>
                </div>
              }
              @if (decodedJWT()!.payload['exp']) {
                <div class="claim-row">
                  <span class="claim-label">Expires (exp):</span>
                  <span class="claim-value" [class.expired]="getExpiryStatus()?.expired">
                    {{ formatTimestamp(decodedJWT()!.payload['exp']) }}
                    @if (getExpiryStatus(); as status) {
                      <span class="expiry-badge" [class.expired]="status.expired">
                        {{ status.timeLeft }}
                      </span>
                    }
                  </span>
                </div>
              }
              @if (decodedJWT()!.payload['nbf']) {
                <div class="claim-row">
                  <span class="claim-label">Not Before (nbf):</span>
                  <span class="claim-value">{{
                    formatTimestamp(decodedJWT()!.payload['nbf'])
                  }}</span>
                </div>
              }
            </div>
          }

          <div class="raw-value"><strong>Raw:</strong> {{ decodedJWT()!.raw.payload }}</div>
        </div>

        <!-- Signature Section -->
        <div class="decoded-section signature-section-box">
          <div class="section-header">
            <h3>‚úçÔ∏è Signature</h3>
          </div>
          <div class="signature-value">
            {{ decodedJWT()!.signature }}
          </div>
          <div class="signature-note">
            <strong>Note:</strong> Signature verification requires the secret key and is not
            performed in the browser for security reasons.
          </div>
        </div>
      </div>
    }
  </div>

  <!-- JWT Information -->
  <div class="info-card">
    <h2>üìö What is JWT (JSON Web Token)?</h2>

    <div class="info-content">
      <p>
        JWT is an open standard (RFC 7519) for securely transmitting information between parties as
        a JSON object. It's digitally signed, so the information can be verified and trusted.
      </p>

      <h3>üîç JWT Structure:</h3>
      <div class="structure-diagram">
        <div class="jwt-part jwt-header">
          <strong>Header</strong>
          <p>Algorithm & Token Type</p>
        </div>
        <span class="jwt-dot">.</span>
        <div class="jwt-part jwt-payload">
          <strong>Payload</strong>
          <p>Claims & Data</p>
        </div>
        <span class="jwt-dot">.</span>
        <div class="jwt-part jwt-signature">
          <strong>Signature</strong>
          <p>Verification Hash</p>
        </div>
      </div>

      <h3>üìù Common Use Cases:</h3>
      <ul class="use-cases">
        <li><strong>Authentication:</strong> Single sign-on, user sessions</li>
        <li><strong>Authorization:</strong> Access control, permissions</li>
        <li><strong>Information Exchange:</strong> Secure data transmission</li>
        <li><strong>API Access:</strong> Bearer tokens for REST APIs</li>
      </ul>

      <h3>‚úÖ Advantages:</h3>
      <ul>
        <li>Compact and self-contained</li>
        <li>Can be transmitted via URL, POST, or HTTP header</li>
        <li>Stateless authentication</li>
        <li>Works across different domains (CORS)</li>
        <li>Easy to scale horizontally</li>
      </ul>

      <h3>‚ö†Ô∏è Security Considerations:</h3>
      <div class="warning-box">
        <ul>
          <li>
            Never store sensitive data in JWT payload (it's only base64 encoded, not encrypted)
          </li>
          <li>Always use HTTPS to transmit JWTs</li>
          <li>Set appropriate expiration times</li>
          <li>Use strong secret keys for signing</li>
          <li>Validate tokens on the server side</li>
          <li>Consider using refresh tokens for long-lived sessions</li>
        </ul>
      </div>

      <h3>üíª Decoding JWT in Code:</h3>
      <div class="code-section">
        <h4>JavaScript/Node.js:</h4>
        <pre><code>// Using jsonwebtoken library
const jwt = require('jsonwebtoken');

// Decode without verification
const decoded = jwt.decode(token);

// Verify and decode
const verified = jwt.verify(token, 'your-secret-key');</code></pre>

        <h4>Python:</h4>
        <pre><code>import jwt

# Decode without verification
decoded = jwt.decode(token, options={{ '{' }}"verify_signature": False{{ '}' }})

# Verify and decode
decoded = jwt.decode(token, 'your-secret-key', algorithms=['HS256'])</code></pre>

        <h4>Bash:</h4>
        <pre><code># Split JWT and decode payload
echo "eyJhbGc..." | cut -d'.' -f2 | base64 -d | jq</code></pre>
      </div>
    </div>
  </div>
</div>
